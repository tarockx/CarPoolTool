@using CarPoolTool.Models
@model IEnumerable<DayLog>

@{
    ViewBag.Title = "Schedule";
    User user = CarPoolTool.Models.User.GetByUsername(User.Identity.Name);
}

<h2>Settimana del @Model.ElementAt(0).Date.ToString("dd/MM")</h2>

<div class="ui styled accordion">
    @for (int i = 0; i < Model.Count(); i++)
    {
        var day = Model.ElementAt(i);
        if (!ViewData.ContainsKey("activeDay"))
        {
            ViewData["activeDay"] = DateTime.Today.DayOfWeek;
        }
        string activeAttr = day.Date.DayOfWeek == (DayOfWeek)ViewData["activeDay"] ? "active" : "";
        string driverStr = day.GetDriverStr();
        string passengersStr = day.GetPassengersStr();
        string absentStr = day.GetAbsentStr();
        string missingStr = day.GetMissingStr();

        string idPopupDayEdit = "popupDayEdit" + i.ToString();

        <div class="@activeAttr title">
            <i class="dropdown icon"></i>
            @day.Date.ToString("dddd dd") 
            <span style="float:right;">
                <i class="teal car icon"></i>
                @driverStr

                <i class="blue road icon"></i>
                @passengersStr
            </span>
        </div>

        <div class="@activeAttr content">
            <table class="ui unstackable definition table">
                <tbody>
                    <!-- Guidatore -->
                    <tr>
                        <td>
                            <i class="teal car icon"></i>
                        </td>
                        <td>
                            @driverStr
                        </td>
                    </tr>

                    <!-- Passeggeri -->
                    <tr>
                        <td>
                            <i class="blue road icon"></i>
                        </td>
                        <td>
                            @passengersStr
                        </td>
                    </tr>

                    <!-- Consiglio dei dieci assenti -->
                    <tr>
                        <td>
                            <i class="red remove user icon"></i>
                        </td>
                        <td>
                            @absentStr
                        </td>
                    </tr>

                    <!-- dispersi -->
                    <tr>
                        <td>
                            <i class="gray help circle icon"></i>
                        </td>
                        <td>
                            @missingStr
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Messaggio non segnato -->
            @if(day.Userdata[user] == UserStatus.MissingData)
            {
                <div class="ui icon yellow message">
                    <i class="warning icon"></i>
                    <div class="content">
                        Non sei segnato per questo giorno 
                        <button class="ui labeled icon button" onclick="$('#@idPopupDayEdit').modal('show');">
                            <i class="orange edit icon"></i>
                            segnati ora
                        </button>
                    </div>
                </div>
            }
        </div>

        <!-- Modification Popup -->
        <div class="ui modal" id="@idPopupDayEdit">
            <div class="header">Ciao @user.display_name!</div>
            <div class="content">
                <p>
                    <h3>
                        Il tuo stato per il giorno @day.Date.ToString("dd/MM") è: 
                        @switch (day.Userdata[user])
                        {
                            case UserStatus.Driver:
                                <i class="ui teal car icon"></i><text>Guidatore</text>
                                break;
                            case UserStatus.Passenger:
                                <i class="ui blue road icon"></i><text>Partecipi</text>
                                break;
                            case UserStatus.Absent:
                                <i class="ui red remove user icon"></i><text>Assente / da solo</text>
                                break;
                            case UserStatus.MissingData:
                                <i class="ui gray help circle icon"></i><text>Non sengato</text>
                                break;
                            default:
                                break;
                        }
                    </h3>
                </p>
                <p>
                    <h3>Vuoi apportare una modifica?</h3>
                </p>
            </div>
            <div class="actions">
                <a class="ui labeled teal icon button">
                    <i class="car icon"></i>
                    Guido io!
                </a>
                <a class="ui labeled blue icon button">
                    <i class="road icon"></i>
                    Partecipo
                </a>
                <a class="ui labeled red icon button">
                    <i class="remove user icon"></i>
                    Da solo / ferie
                </a>
            </div>
        </div>
    }
</div>

@section Scripts
{
    <script>
        $('.ui.accordion').accordion();
    </script>
}